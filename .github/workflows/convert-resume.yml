name: Auto-Convert Resume DOCX to HTML

on:
  push:
    paths:
      - 'resume.docx'
    branches: [ main, master ]
  workflow_dispatch:  # Allow manual trigger for testing

jobs:
  convert-resume:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # Required to commit back to repository
    
    steps:
    - name: 🔄 Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: 📋 Verify resume.docx exists
      run: |
        if [ ! -f "resume.docx" ]; then
          echo "❌ resume.docx not found in repository root!"
          echo "📁 Available files:"
          ls -la
          exit 1
        fi
        echo "✅ Found resume.docx"
        ls -lh resume.docx
    
    - name: 🚀 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: 📦 Install Dependencies
      run: |
        npm init -y --silent
        npm install mammoth --silent
    
    - name: 🔄 Convert DOCX to HTML
      run: |
        cat > convert.js << 'EOF'
        const mammoth = require('mammoth');
        const fs = require('fs');
        
        console.log('🔄 Starting conversion...');
        
        mammoth.convertToHtml({path: './resume.docx'})
          .then(result => {
            const htmlContent = result.value;
            
            // Create complete HTML with modern styling
            const completeHTML = `<!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Punit Makhija - Interactive Resume</title>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                    line-height: 1.6;
                    color: #2c3e50;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    padding: 20px 0;
                }
                
                .container {
                    max-width: 900px;
                    margin: 0 auto;
                    background: white;
                    border-radius: 20px;
                    box-shadow: 0 25px 50px rgba(0,0,0,0.15);
                    overflow: hidden;
                    animation: slideUp 0.8s ease-out;
                }
                
                @keyframes slideUp {
                    from { 
                        opacity: 0; 
                        transform: translateY(50px); 
                    }
                    to { 
                        opacity: 1; 
                        transform: translateY(0); 
                    }
                }
                
                .header {
                    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                    color: white;
                    padding: 50px 40px;
                    text-align: center;
                    position: relative;
                    overflow: hidden;
                }
                
                .header::before {
                    content: '';
                    position: absolute;
                    top: -50%;
                    left: -50%;
                    width: 200%;
                    height: 200%;
                    background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
                    background-size: 30px 30px;
                    animation: float 20s infinite linear;
                }
                
                @keyframes float {
                    0% { transform: translate(0, 0) rotate(0deg); }
                    100% { transform: translate(-50px, -50px) rotate(360deg); }
                }
                
                .header h1 {
                    font-size: 3rem;
                    margin-bottom: 15px;
                    position: relative;
                    z-index: 2;
                    font-weight: 700;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                }
                
                .contact-info {
                    display: flex;
                    justify-content: center;
                    gap: 30px;
                    flex-wrap: wrap;
                    position: relative;
                    z-index: 2;
                    font-size: 1.1rem;
                    margin-top: 20px;
                }
                
                .contact-item {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    background: rgba(255,255,255,0.15);
                    padding: 10px 20px;
                    border-radius: 25px;
                    backdrop-filter: blur(10px);
                    transition: all 0.3s ease;
                    cursor: pointer;
                    border: 1px solid rgba(255,255,255,0.2);
                }
                
                .contact-item:hover {
                    background: rgba(255,255,255,0.25);
                    transform: translateY(-3px);
                    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
                }
                
                .content {
                    padding: 50px 40px;
                }
                
                .resume-content h2 {
                    color: #1e3c72;
                    font-size: 1.8rem;
                    margin: 30px 0 20px 0;
                    padding-bottom: 10px;
                    border-bottom: 3px solid #3498db;
                    position: relative;
                }
                
                .resume-content h2::after {
                    content: '';
                    position: absolute;
                    bottom: -3px;
                    left: 0;
                    width: 50px;
                    height: 3px;
                    background: #e74c3c;
                    border-radius: 2px;
                }
                
                .resume-content p {
                    margin-bottom: 15px;
                    text-align: justify;
                    font-size: 1.05rem;
                }
                
                .resume-content ul {
                    margin: 20px 0;
                    padding-left: 0;
                }
                
                .resume-content li {
                    list-style: none;
                    padding: 8px 0 8px 30px;
                    position: relative;
                    transition: all 0.3s ease;
                    border-radius: 5px;
                }
                
                .resume-content li:before {
                    content: '▶';
                    color: #3498db;
                    position: absolute;
                    left: 10px;
                    transition: all 0.3s ease;
                }
                
                .resume-content li:hover {
                    background: #f8f9fa;
                    padding-left: 35px;
                    color: #1e3c72;
                }
                
                .resume-content li:hover:before {
                    color: #e74c3c;
                    transform: scale(1.2);
                }
                
                .download-section {
                    text-align: center;
                    padding: 40px;
                    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                    margin: 40px 0 0 0;
                    border-radius: 15px;
                    border-top: 4px solid #3498db;
                }
                
                .download-btn {
                    display: inline-flex;
                    align-items: center;
                    gap: 12px;
                    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                    color: white;
                    padding: 15px 30px;
                    border: none;
                    border-radius: 50px;
                    font-size: 1.1rem;
                    font-weight: 600;
                    text-decoration: none;
                    transition: all 0.3s ease;
                    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
                }
                
                .download-btn:hover {
                    background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
                    transform: translateY(-3px);
                    box-shadow: 0 12px 30px rgba(52, 152, 219, 0.4);
                }
                
                .last-updated {
                    text-align: center;
                    margin-top: 30px;
                    padding: 20px;
                    background: #f8f9fa;
                    border-radius: 10px;
                    color: #7f8c8d;
                    font-size: 0.9rem;
                }
                
                @media (max-width: 768px) {
                    body { padding: 10px 0; }
                    .container { margin: 0 10px; border-radius: 15px; }
                    .header { padding: 40px 20px; }
                    .header h1 { font-size: 2.2rem; }
                    .contact-info { flex-direction: column; align-items: center; }
                    .content { padding: 30px 20px; }
                    .resume-content h2 { font-size: 1.5rem; }
                }
                
                .notification {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #27ae60;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 50px;
                    font-weight: 600;
                    box-shadow: 0 10px 30px rgba(39, 174, 96, 0.3);
                    transform: translateX(400px);
                    transition: transform 0.5s ease;
                    z-index: 9999;
                }
                
                .notification.show {
                    transform: translateX(0);
                }
            </style>
        </head>
        <body>
            <div class="container">
                <header class="header">
                    <h1><i class="fas fa-user-tie"></i> Punit Makhija</h1>
                    <div class="contact-info">
                        <div class="contact-item" onclick="copyToClipboard('571-451-6076', 'Phone number')">
                            <i class="fas fa-phone"></i>
                            <span>571-451-6076</span>
                        </div>
                        <div class="contact-item" onclick="copyToClipboard('Punit.Makhija1@gmail.com', 'Email address')">
                            <i class="fas fa-envelope"></i>
                            <span>Punit.Makhija1@gmail.com</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-flag-usa"></i>
                            <span>US Citizen</span>
                        </div>
                    </div>
                </header>
                
                <main class="content">
                    <div class="resume-content">
                        ${htmlContent}
                    </div>
                    
                    <div class="download-section">
                        <h3><i class="fas fa-download"></i> Download Resume</h3>
                        <p>Get the original document in Word format</p>
                        <a href="./resume.docx" class="download-btn" download>
                            <i class="fas fa-file-word"></i>
                            Download DOCX
                        </a>
                    </div>
                    
                    <div class="last-updated">
                        <i class="fas fa-clock"></i> Last updated: ${new Date().toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </div>
                </main>
            </div>
            
            <script>
                function copyToClipboard(text, type) {
                    navigator.clipboard.writeText(text).then(() => {
                        showNotification(\`\${type} copied to clipboard!\`);
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        showNotification('Failed to copy', 'error');
                    });
                }
                
                function showNotification(message, type = 'success') {
                    const notification = document.createElement('div');
                    notification.className = 'notification';
                    notification.innerHTML = \`<i class="fas fa-check-circle"></i> \${message}\`;
                    
                    if (type === 'error') {
                        notification.style.background = '#e74c3c';
                        notification.innerHTML = \`<i class="fas fa-exclamation-circle"></i> \${message}\`;
                    }
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => notification.classList.add('show'), 100);
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 500);
                    }, 3000);
                }
                
                // Add smooth scroll behavior
                document.documentElement.style.scrollBehavior = 'smooth';
                
                // Add entrance animations for list items
                document.addEventListener('DOMContentLoaded', () => {
                    const listItems = document.querySelectorAll('.resume-content li');
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach((entry, index) => {
                            if (entry.isIntersecting) {
                                setTimeout(() => {
                                    entry.target.style.animation = 'slideInLeft 0.6s ease-out';
                                }, index * 100);
                            }
                        });
                    }, { threshold: 0.1 });
                    
                    listItems.forEach(item => observer.observe(item));
                });
                
                // Add CSS for slide in animation
                const style = document.createElement('style');
                style.textContent = \`
                    @keyframes slideInLeft {
                        from {
                            opacity: 0;
                            transform: translateX(-30px);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }
                \`;
                document.head.appendChild(style);
            </script>
        </body>
        </html>`;
            
            // Write the HTML file
            fs.writeFileSync('./index.html', completeHTML);
            
            console.log('✅ Successfully converted resume.docx to index.html');
            console.log('📄 HTML file size:', Math.round(completeHTML.length / 1024), 'KB');
            
            if (result.messages && result.messages.length > 0) {
                console.log('⚠️  Conversion warnings:');
                result.messages.forEach(msg => console.log('   -', msg.message));
            }
          })
          .catch(error => {
            console.error('❌ Conversion failed:', error);
            process.exit(1);
          });
        EOF
        
        echo "🔄 Running conversion script..."
        node convert.js
    
    - name: ✅ Verify HTML Creation
      run: |
        if [ -f "index.html" ]; then
          echo "✅ index.html created successfully!"
          echo "📊 File size: $(du -h index.html | cut -f1)"
          echo "📝 First few lines:"
          head -n 5 index.html
        else
          echo "❌ index.html was not created!"
          exit 1
        fi
    
    - name: 📝 Commit Changes
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        git add index.html
        
        if git diff --staged --quiet; then
          echo "📝 No changes detected in index.html"
        else
          echo "📝 Committing updated index.html..."
          git commit -m "🤖 Auto-update HTML resume from resume.docx
          
          - Converted resume.docx to interactive HTML
          - Updated on $(date)
          - Generated by GitHub Actions
          
          [skip ci]"
          
          echo "🚀 Pushing changes to repository..."
          git push
          
          echo "✅ Successfully updated index.html in repository!"
        fi
